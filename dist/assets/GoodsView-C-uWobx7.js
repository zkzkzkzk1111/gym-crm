import{u as W}from"./goods-Cu4v4TCi.js";import{u as X,_ as Y,a as Z}from"./CategoryInputDialog.vue_vue_type_script_setup_true_lang-wfhkHHWF.js";import{U as ee,_ as ae}from"./UiParentCard.vue_vue_type_script_setup_true_lang-CBB4u1YX.js";import{x as te,aH as D,G as r,aI as le,ah as oe,c as G,w as o,o as i,f as t,m as x,h as V,A as m,aJ as ne,L as se,aM as re,E as ie,a3 as S,F as ue,n as de,a4 as I,g as L,b as g,t as s,J as k,_ as ce,ab as fe,aw as me,ac as ve,s as c,aG as pe,aL as B}from"./index-ChThWpwh.js";import{_ as _e}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-1MLmho_D.js";import{_ as ye}from"./NotificeBar-SNjTBcAG.js";import"./goodsService-D9gxH4bt.js";import"./axios-D8WuJDhL.js";import"./staffService-B334Pa8R.js";import"./classService-DyrUrkM7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ce={key:0},he={key:1},xe={class:"text-h6 mb-2"},Ve={class:"text-h6 mb-2"},ge={class:"text-h6 mb-2"},Te={class:"text-h6 mb-2"},$e={key:0,class:"text-body-2 mt-3"},Ue=te({__name:"GoodsView",setup(Ge){const v=W(),u=X(),{filteredGoods:w,filter:T,loading:b}=D(v),{goodsTypes:N}=D(u),p=r(!1),n=r(!1),_=r(null),$=r(!1),y=r(!1),d=r("add"),f=r(null);le(()=>{v.fetchAll(),u.fetchAll()});function E(l){B.replace({path:`/editGoods/${l}`})}function U(l){p.value=!0,_.value=l}function F(){_.value!==null&&v.deleteGoods(_.value).then(l=>{p.value=!1,l.success&&(n.value=!0,setTimeout(()=>{n.value=!1,v.fetchAll()},1e3))}).finally(()=>_.value=null)}function M(){p.value=!1}function j(){n.value=!1}function z(){B.replace({path:"/goods/new"})}function O(l){const e=N.value.find(C=>C.idx===l);return e?e.typeName:"미분류"}async function R(){await u.fetchGoodsTypes(),$.value=!0}const J=oe(()=>N.value.map(l=>({id:l.idx,name:l.typeName})));function H(){d.value="add",f.value=null,y.value=!0}function P(l){d.value="edit",f.value=l,y.value=!0}async function q(l){if(confirm(`${l.name}을(를) 삭제하시겠습니까?`))try{const e=await u.deleteGoodsType(l.id);e.success?(n.value=!0,setTimeout(()=>{n.value=!1},1e3)):alert(`삭제에 실패했습니다: ${e.error||"알 수 없는 오류"}`)}catch(e){console.error("카테고리 삭제 실패:",e),alert(`삭제에 실패했습니다: ${e.message||"알 수 없는 오류"}`)}}async function K(l){try{let e;if(d.value==="add")e=await u.createGoodsType(l);else{if(!f.value)return;e=await u.updateGoodsType(f.value.id,l)}e.success?(n.value=!0,setTimeout(()=>{n.value=!1},1e3)):alert(`${d.value==="add"?"추가":"수정"}에 실패했습니다: ${e.error||"알 수 없는 오류"}`)}catch(e){console.error("카테고리 처리 실패:",e),alert(`${d.value==="add"?"추가":"수정"}에 실패했습니다: ${e.message||"알 수 없는 오류"}`)}}return(l,e)=>(i(),G(ee,null,{default:o(()=>{var C;return[t(ae,{title:"상품 관리",createFn:z},{"extra-actions":o(()=>[t(k,{onClick:R,color:"primary",variant:"outlined"},{prepend:o(()=>[t(ce,{icon:"$new",size:"x-large"})]),default:o(()=>[e[3]||(e[3]=g(" 상품 타입 관리 "))]),_:1})]),default:o(()=>[m(b)?(i(),x("div",Ce,[t(ne,{color:"secondary",height:"6",indeterminate:"",rounded:""})])):V("",!0),m(b)?V("",!0):(i(),x("div",he,[t(se,{modelValue:m(T),"onUpdate:modelValue":e[0]||(e[0]=a=>re(T)?T.value=a:null),variant:"solo-filled",class:"pa-2",label:"검색"},null,8,["modelValue"]),t(ie,{class:"mb-10"}),t(S,null,{default:o(()=>[(i(!0),x(ue,null,de(m(w),(a,Q)=>(i(),G(I,{cols:"12",md:"4",sm:"6",key:(a==null?void 0:a.idx)||Q},{default:o(()=>[a?(i(),G(fe,{key:0,variant:"elevated",class:"mx-auto ma-5","max-width":"360"},{default:o(()=>[t(me,{class:"text-h3"},{default:o(()=>[g(s(a.goodsName),1)]),_:2},1024),t(ve,null,{default:o(()=>{var h,A;return[c("div",xe,"이용기간: "+s(a.duration)+"개월",1),c("div",Ve,"이용가능 횟수: "+s(a.useCount)+"회",1),c("div",ge,"현금가: "+s((h=a.cash)==null?void 0:h.toLocaleString())+"원",1),c("div",Te,"카드가: "+s((A=a.card)==null?void 0:A.toLocaleString())+"원",1),a.description?(i(),x("div",$e,s(a.description),1)):V("",!0)]}),_:2},1024),t(pe,{class:"d-flex justify-space-between"},{default:o(()=>[c("div",null,[t(L,{color:"primary"},{default:o(()=>[g("타입: "+s(O(a.type)),1)]),_:2},1024)]),c("div",null,[t(k,{color:"secondary mb-0",variant:"outlined",text:"수정",title:"Edit",size:"small",onClick:h=>E(a.idx)},null,8,["onClick"]),t(k,{color:"error",variant:"plain",text:"삭제",size:"small",onClick:h=>U(a.idx)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)):V("",!0)]),_:2},1024))),128))]),_:1}),t(S,{justify:"center"},{default:o(()=>[t(I,{cols:"12",lg:"12",class:"d-flex justify-center"},{default:o(()=>[t(L,{class:"text-h5",color:"primary"},{default:o(()=>[g(" 총 상품 수: "+s(m(w).length),1)]),_:1})]),_:1})]),_:1})]))]),_:1}),t(_e,{dialog:p.value,onOnConfirm:F,onOnCancel:M},null,8,["dialog"]),t(ye,{notice:n.value,onOnClose:j},null,8,["notice"]),t(Y,{modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=a=>$.value=a),title:"상품 타입 관리",categories:J.value,onAdd:H,onEdit:P,onDelete:q},null,8,["modelValue","categories"]),t(Z,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),title:d.value==="add"?"상품 타입 추가":"상품 타입 수정",label:"타입 이름","initial-value":((C=f.value)==null?void 0:C.name)||"",onConfirm:K},null,8,["modelValue","title","initial-value"])]}),_:1}))}});export{Ue as default};
