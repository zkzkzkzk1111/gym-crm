import{x as Y,c as P,o as y,z as Le,w as t,h as O,ab as G,f as e,ac as I,s as u,u as ne,aC as ue,t as d,g as j,b as o,E as T,B as H,k as C,i as V,j as w,J as x,_ as f,aD as De,aE as Se,Z as W,G as g,ah as U,aF as Te,aw as ae,a3 as se,a4 as X,m as q,n as oe,F as re,aG as Ne,H as ze,aH as Z,aI as Ae,A as F,aJ as Ie,aK as Ue,X as qe,L as Be,aL as ie}from"./index-ChThWpwh.js";import{u as Ee,m as Re}from"./members-BzmwLjda.js";import{u as Fe}from"./goods-Cu4v4TCi.js";import{u as Ge,_ as je,a as He}from"./CategoryInputDialog.vue_vue_type_script_setup_true_lang-wfhkHHWF.js";import{u as Oe}from"./purchase-Dvd9RgU3.js";import{U as Je,_ as Ke}from"./UiParentCard.vue_vue_type_script_setup_true_lang-CBB4u1YX.js";import{_ as Qe}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-1MLmho_D.js";import{_ as Xe}from"./NotificeBar-SNjTBcAG.js";import{_ as Ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./axios-D8WuJDhL.js";import"./goodsService-D9gxH4bt.js";import"./staffService-B334Pa8R.js";import"./classService-DyrUrkM7.js";const We={class:"text-center mb-4"},Ye={class:"mt-3"},et={class:"info-section mb-4"},tt={class:"info-section mb-4"},lt={class:"info-section mb-4"},at={class:"mt-4"},st="/src/assets/images/customer/avatar-0.webp",ot=Y({__name:"MemberDetailSidebar",props:{drawer:{type:Boolean},selectedMember:{},getGoodsName:{type:Function}},emits:["close","purchase"],setup(ee,{emit:N}){const b=N;return(i,a)=>(y(),P(Le,{"model-value":i.drawer,location:"right",temporary:"",width:"400","onUpdate:modelValue":a[2]||(a[2]=D=>b("close"))},{prepend:t(()=>[e(De,{color:"primary",dark:""},{default:t(()=>[e(Se,null,{default:t(()=>a[3]||(a[3]=[o("회원 정보")])),_:1}),e(W),e(x,{icon:"",onClick:a[0]||(a[0]=D=>b("close"))},{default:t(()=>[e(f,null,{default:t(()=>a[4]||(a[4]=[o("mdi-close")])),_:1})]),_:1})]),_:1})]),default:t(()=>[i.selectedMember?(y(),P(G,{key:0,flat:""},{default:t(()=>[e(I,null,{default:t(()=>[u("div",We,[e(ne,{size:"80",color:"primary"},{default:t(()=>[e(ue,{src:st})]),_:1}),u("h3",Ye,d(i.selectedMember.userName),1),e(j,{color:i.selectedMember.status==="정상"?"success":"warning",size:"small",class:"mt-2"},{default:t(()=>[o(d(i.selectedMember.status),1)]),_:1},8,["color"])]),e(T,{class:"my-4"}),u("div",et,[a[9]||(a[9]=u("h4",{class:"text-h6 mb-3"},"기본 정보",-1)),e(H,{density:"compact"},{default:t(()=>[e(C,null,{default:t(()=>[e(V,{class:"text-grey-darken-1"},{default:t(()=>a[5]||(a[5]=[o("연락처")])),_:1}),e(w,{class:"text-body-1"},{default:t(()=>[o(d(i.selectedMember.phone||"-"),1)]),_:1})]),_:1}),e(C,null,{default:t(()=>[e(V,{class:"text-grey-darken-1"},{default:t(()=>a[6]||(a[6]=[o("성별")])),_:1}),e(w,{class:"text-body-1"},{default:t(()=>[o(d(i.selectedMember.gender||"-"),1)]),_:1})]),_:1}),e(C,null,{default:t(()=>[e(V,{class:"text-grey-darken-1"},{default:t(()=>a[7]||(a[7]=[o("생년월일")])),_:1}),e(w,{class:"text-body-1"},{default:t(()=>[o(d(i.selectedMember.birth||"-"),1)]),_:1})]),_:1}),e(C,null,{default:t(()=>[e(V,{class:"text-grey-darken-1"},{default:t(()=>a[8]||(a[8]=[o("나이")])),_:1}),e(w,{class:"text-body-1"},{default:t(()=>[o(d(i.selectedMember.age?`${i.selectedMember.age}세`:"-"),1)]),_:1})]),_:1})]),_:1})]),e(T,{class:"my-4"}),u("div",tt,[a[14]||(a[14]=u("h4",{class:"text-h6 mb-3"},"이용권 정보",-1)),e(H,{density:"compact"},{default:t(()=>[e(C,null,{default:t(()=>[e(V,{class:"text-grey-darken-1"},{default:t(()=>a[10]||(a[10]=[o("보유 이용권")])),_:1}),e(w,{class:"text-body-1"},{default:t(()=>[o(d(i.getGoodsName(i.selectedMember.getUtilization)),1)]),_:1})]),_:1}),e(C,null,{default:t(()=>[e(V,{class:"text-grey-darken-1"},{default:t(()=>a[11]||(a[11]=[o("등록일")])),_:1}),e(w,{class:"text-body-1"},{default:t(()=>[o(d(i.selectedMember.regDt||"-"),1)]),_:1})]),_:1}),e(C,null,{default:t(()=>[e(V,{class:"text-grey-darken-1"},{default:t(()=>a[12]||(a[12]=[o("종료일")])),_:1}),e(w,{class:"text-body-1"},{default:t(()=>[o(d(i.selectedMember.endDt||"-"),1)]),_:1})]),_:1}),e(C,null,{default:t(()=>[e(V,{class:"text-grey-darken-1"},{default:t(()=>a[13]||(a[13]=[o("남은일수")])),_:1}),e(w,{class:"text-body-1"},{default:t(()=>[o(d(i.selectedMember.dayNum?`${i.selectedMember.dayNum}일`:"-"),1)]),_:1})]),_:1})]),_:1})]),e(T,{class:"my-4"}),u("div",lt,[a[16]||(a[16]=u("h4",{class:"text-h6 mb-3"},"담당자",-1)),e(H,{density:"compact"},{default:t(()=>[e(C,null,{default:t(()=>[e(V,{class:"text-grey-darken-1"},{default:t(()=>a[15]||(a[15]=[o("상담자")])),_:1}),e(w,{class:"text-body-1"},{default:t(()=>[o(d(i.selectedMember.consultantName||"-"),1)]),_:1})]),_:1})]),_:1})]),u("div",at,[e(x,{color:"success",variant:"elevated",block:"",size:"large",onClick:a[1]||(a[1]=D=>b("purchase"))},{default:t(()=>[e(f,{left:""},{default:t(()=>a[17]||(a[17]=[o("mdi-cart-plus")])),_:1}),a[18]||(a[18]=o(" 구매하기 "))]),_:1})])]),_:1})]),_:1})):O("",!0)]),_:1},8,["model-value"]))}}),rt={style:{"max-height":"500px","overflow-y":"auto","padding-right":"8px"}},it={class:"mb-2"},nt={class:"mb-2"},ut={class:"mt-2"},dt={class:"text-body-1 font-weight-bold text-success"},ct={class:"mt-1"},mt={class:"text-body-1 font-weight-bold text-info"},ft={key:0,class:"text-center py-8 text-grey"},vt={class:"w-100"},pt={class:"d-flex align-center mb-2"},gt={class:"flex-grow-1"},yt={class:"font-weight-bold"},bt={class:"text-caption text-grey"},_t={class:"d-flex align-center mb-2"},xt={class:"d-flex align-center justify-space-between"},kt={class:"d-flex align-center"},Ct={class:"mx-3 font-weight-bold"},ht={class:"text-h6 text-primary font-weight-bold"},Vt={class:"d-flex justify-space-between align-center mb-3"},wt={class:"text-h5 text-primary font-weight-bold"},$t=Y({__name:"PurchaseDialog",props:{dialog:{type:Boolean},goodsList:{}},emits:["close","purchase"],setup(ee,{emit:N}){const b=N,i=g([]);function a(c){const l=i.value.find(n=>n.idx===c.idx);l?l.quantity+=1:i.value.push({...c,quantity:1,paymentType:"cash",selectedPrice:c.cash})}function D(c,l){const n=i.value[c];i.value[c].paymentType=l,i.value[c].selectedPrice=l==="cash"?n.cash:n.card}function J(){i.value=[]}function z(c){i.value.splice(c,1)}function A(c,l){l<=0?z(c):i.value[c].quantity=l}const K=U(()=>i.value.reduce((c,l)=>c+l.selectedPrice*l.quantity,0));function Q(){if(i.value.length===0){alert("상품을 선택해주세요.");return}b("purchase",i.value),i.value=[]}function B(){b("close"),i.value=[]}return(c,l)=>(y(),P(Te,{"model-value":c.dialog,"max-width":"1200px",scrollable:"","onUpdate:modelValue":B},{default:t(()=>[e(G,null,{default:t(()=>[e(ae,{class:"text-h5 bg-primary text-white"},{default:t(()=>[e(f,{class:"mr-2"},{default:t(()=>l[0]||(l[0]=[o("mdi-shopping")])),_:1}),l[2]||(l[2]=o(" 상품 구매 ")),e(W),e(x,{icon:"",onClick:B,variant:"text"},{default:t(()=>[e(f,{color:"white"},{default:t(()=>l[1]||(l[1]=[o("mdi-close")])),_:1})]),_:1})]),_:1}),e(I,{class:"pa-4"},{default:t(()=>[e(se,null,{default:t(()=>[e(X,{cols:"12",md:"8"},{default:t(()=>[l[7]||(l[7]=u("h3",{class:"mb-3"},"상품 목록",-1)),u("div",rt,[e(se,null,{default:t(()=>[(y(!0),q(re,null,oe(c.goodsList,n=>(y(),P(X,{key:n.idx,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[e(G,{hover:"",elevation:"2",onClick:p=>a(n),class:"cursor-pointer"},{default:t(()=>[e(I,null,{default:t(()=>{var p,h;return[u("h4",it,d(n.goodsName),1),u("div",nt,[e(j,{size:"small",color:"primary"},{default:t(()=>[o(d(n.duration)+"개월 ",1)]),_:2},1024),e(j,{size:"small",color:"secondary",class:"ml-1"},{default:t(()=>[o(d(n.useCount)+"회 ",1)]),_:2},1024)]),u("div",ut,[l[3]||(l[3]=u("div",{class:"text-caption text-grey-darken-1"},"현금",-1)),u("div",dt,d((p=n.cash)==null?void 0:p.toLocaleString())+"원 ",1)]),u("div",ct,[l[4]||(l[4]=u("div",{class:"text-caption text-grey-darken-1"},"카드",-1)),u("div",mt,d((h=n.card)==null?void 0:h.toLocaleString())+"원 ",1)])]}),_:2},1024),e(Ne,null,{default:t(()=>[e(x,{color:"primary",variant:"text",size:"small",block:""},{default:t(()=>[e(f,{left:""},{default:t(()=>l[5]||(l[5]=[o("mdi-cart-plus")])),_:1}),l[6]||(l[6]=o(" 담기 "))]),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])]),_:1}),e(X,{cols:"12",md:"4"},{default:t(()=>[e(G,{elevation:"3",class:"sticky-cart"},{default:t(()=>[e(ae,{class:"bg-grey-lighten-4 d-flex align-center"},{default:t(()=>[e(f,{class:"mr-2"},{default:t(()=>l[8]||(l[8]=[o("mdi-cart")])),_:1}),l[10]||(l[10]=o(" 장바구니 ")),e(j,{class:"ml-2",size:"small",color:"primary"},{default:t(()=>[o(d(i.value.length),1)]),_:1}),e(W),i.value.length>0?(y(),P(x,{key:0,icon:"",size:"small",color:"error",variant:"text",onClick:J},{default:t(()=>[e(f,null,{default:t(()=>l[9]||(l[9]=[o("mdi-delete-sweep")])),_:1})]),_:1})):O("",!0)]),_:1}),e(T),e(I,{style:{"max-height":"400px","overflow-y":"auto"}},{default:t(()=>[i.value.length===0?(y(),q("div",ft,[e(f,{size:"64",color:"grey-lighten-1"},{default:t(()=>l[11]||(l[11]=[o("mdi-cart-outline")])),_:1}),l[12]||(l[12]=u("p",{class:"mt-3"},"상품을 선택해주세요",-1))])):(y(),P(H,{key:1},{default:t(()=>[(y(!0),q(re,null,oe(i.value,(n,p)=>(y(),P(C,{key:p,class:"mb-3 border rounded pa-2"},{default:t(()=>{var h,$;return[u("div",vt,[u("div",pt,[e(f,{color:"primary",class:"mr-2"},{default:t(()=>l[13]||(l[13]=[o("mdi-package-variant")])),_:1}),u("div",gt,[u("div",yt,d(n.goodsName),1),u("div",bt,d(n.duration)+"개월 / "+d(n.useCount)+"회 ",1)]),e(x,{icon:"",size:"small",color:"error",variant:"text",onClick:k=>z(p)},{default:t(()=>[e(f,null,{default:t(()=>l[14]||(l[14]=[o("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),e(T,{class:"my-2"}),u("div",_t,[e(ze,{items:[{title:`현금: ${(h=n.cash)==null?void 0:h.toLocaleString()}원`,value:"cash"},{title:`카드: ${($=n.card)==null?void 0:$.toLocaleString()}원`,value:"card"}],modelValue:n.paymentType,"onUpdate:modelValue":[k=>n.paymentType=k,k=>D(p,k)],density:"compact",variant:"outlined","hide-details":"",class:"flex-grow-1"},null,8,["items","modelValue","onUpdate:modelValue"])]),u("div",xt,[u("div",kt,[e(x,{icon:"",size:"small",variant:"text",onClick:k=>A(p,n.quantity-1)},{default:t(()=>[e(f,null,{default:t(()=>l[15]||(l[15]=[o("mdi-minus")])),_:1})]),_:2},1032,["onClick"]),u("span",Ct,d(n.quantity),1),e(x,{icon:"",size:"small",variant:"text",onClick:k=>A(p,n.quantity+1)},{default:t(()=>[e(f,null,{default:t(()=>l[16]||(l[16]=[o("mdi-plus")])),_:1})]),_:2},1032,["onClick"])]),u("div",ht,d((n.selectedPrice*n.quantity).toLocaleString())+"원 ",1)])])]}),_:2},1024))),128))]),_:1}))]),_:1}),e(T),e(I,{class:"bg-grey-lighten-5"},{default:t(()=>[u("div",Vt,[l[17]||(l[17]=u("span",{class:"text-h6"},"총 금액",-1)),u("span",wt,d(K.value.toLocaleString())+"원 ",1)]),e(x,{color:"success",variant:"elevated",block:"",size:"large",disabled:i.value.length===0,onClick:Q},{default:t(()=>[e(f,{left:""},{default:t(()=>l[18]||(l[18]=[o("mdi-credit-card")])),_:1}),l[19]||(l[19]=o(" 결제하기 "))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),Pt=Ze($t,[["__scopeId","data-v-b1a63570"]]),Mt={key:0},Lt={key:1},Dt="/src/assets/images/customer/avatar-0.webp",jt=Y({__name:"MemberList",setup(ee){const N=[{title:"",key:"avatar",align:"start"},{title:"상태",key:"status",align:"start"},{title:"이름",key:"userName",align:"start"},{title:"연락처",key:"phone",align:"start"},{title:"성별",key:"gender",align:"start"},{title:"생년월일",key:"birth",align:"start"},{title:"나이",key:"age",align:"end"},{title:"보유 이용권",key:"getUtilization",align:"end"},{title:"등록일",key:"regDt",align:"end"},{title:"종료일",key:"endDt",align:"end"},{title:"남은일수",key:"dayNum",align:"end"},{title:"상담자",key:"consultantName",align:"start"},{title:"",key:"idx",align:"end"}],b=Ee(),i=Fe(),a=Ge(),D=Oe(),{filteredMembers:J,loading:z}=Z(b),{goodsList:A}=Z(i),{visitPaths:K,purposes:Q,memberStatuses:B}=Z(a),c=g(!1),l=g(""),n=g(!1),p=g(null),h=g(!1),$=g(null),k=g(!1),E=g(!1),v=g("visitPath"),R=g(!1),S=g("add"),M=g(null);Ae(()=>{b.fetchAll(),i.fetchAll(),a.fetchAll()});function de(r){ie.replace({path:`/member/${r}`})}function ce(r){c.value=!0,p.value=r}async function me(){if(p.value!==null)try{await Re.delete(p.value),n.value=!0,setTimeout(()=>{n.value=!1,b.fetchAll()},1e3)}catch(r){console.error("회원 삭제 실패:",r),alert(`회원 삭제에 실패했습니다: ${r.message||"알 수 없는 오류"}`)}finally{p.value=null}}function fe(){n.value=!1}function ve(){ie.replace({path:"/member/write"})}function te(r){if(!r)return"-";const s=A.value.find(_=>_.idx===r);return s?s.goodsName:"-"}function pe(r,s){$.value=s.item,h.value=!0}function ge(){h.value=!1,$.value=null}function ye(){k.value=!0}function le(){k.value=!1}async function be(r){if(!$.value){alert("회원 정보를 찾을 수 없습니다.");return}const s=r.reduce((_,m)=>_+m.selectedPrice*m.quantity,0);if(confirm(`총 ${s.toLocaleString()}원을 결제하시겠습니까?`))try{const _=r.map(L=>({memberIdx:$.value.idx,type:L.typeName||"상품",name:L.goodsName,cnt:L.quantity,price:L.selectedPrice,paymentMethod:L.paymentType==="cash"?"현금":"카드"})),m=await D.createPurchaseBulk(_);m.success?(n.value=!0,setTimeout(()=>{n.value=!1},1e3),alert(`총 ${s.toLocaleString()}원 결제가 완료되었습니다.`),le(),b.fetchAll()):alert(`결제가 실패했습니다: ${m.error||"알 수 없는 오류"}`)}catch(_){console.error("결제 처리 실패:",_),alert(`결제 처리에 실패했습니다: ${_.message||"알 수 없는 오류"}`)}}function _e(){v.value="visitPath",E.value=!0}function xe(){v.value="purpose",E.value=!0}const ke=U(()=>v.value==="visitPath"?K.value.map(r=>({id:r.idx,name:r.visitPathName})):v.value==="purpose"?Q.value.map(r=>({id:r.idx,name:r.purposeName})):B.value.map(r=>({id:r.idx,name:r.statusName}))),Ce=U(()=>v.value==="visitPath"?"방문경로 관리":v.value==="purpose"?"운동목적 관리":"회원상태 관리"),he=U(()=>{let r="방문경로";v.value==="purpose"&&(r="운동목적"),v.value==="memberStatus"&&(r="회원상태");const s=S.value==="add"?"추가":"수정";return`${r} ${s}`}),Ve=U(()=>v.value==="visitPath"?"방문경로 이름":v.value==="purpose"?"운동목적 이름":"회원상태 이름");function we(){S.value="add",M.value=null,R.value=!0}function $e(r){S.value="edit",M.value=r,R.value=!0}async function Pe(r){if(confirm(`${r.name}을(를) 삭제하시겠습니까?`))try{let s;v.value==="visitPath"?s=await a.deleteVisitPath(r.id):v.value==="purpose"?s=await a.deletePurpose(r.id):s=await a.deleteMemberStatus(r.id),s.success?(n.value=!0,setTimeout(()=>{n.value=!1},1e3)):alert(`삭제에 실패했습니다: ${s.error||"알 수 없는 오류"}`)}catch(s){console.error("카테고리 삭제 실패:",s),alert(`삭제에 실패했습니다: ${s.message||"알 수 없는 오류"}`)}}async function Me(r){try{let s;if(S.value==="add")v.value==="visitPath"?s=await a.createVisitPath(r):v.value==="purpose"?s=await a.createPurpose(r):s=await a.createMemberStatus(r);else{if(!M.value)return;v.value==="visitPath"?s=await a.updateVisitPath(M.value.id,r):v.value==="purpose"?s=await a.updatePurpose(M.value.id,r):s=await a.updateMemberStatus(M.value.id,r)}s.success?(n.value=!0,setTimeout(()=>{n.value=!1},1e3)):alert(`${S.value==="add"?"추가":"수정"}에 실패했습니다: ${s.error||"알 수 없는 오류"}`)}catch(s){console.error("카테고리 처리 실패:",s),alert(`${S.value==="add"?"추가":"수정"}에 실패했습니다: ${s.message||"알 수 없는 오류"}`)}}return(r,s)=>(y(),P(Je,null,{default:t(()=>{var _;return[e(Ke,{title:"회원 관리",createFn:ve},{"extra-actions":t(()=>[e(x,{onClick:_e,color:"primary",variant:"outlined"},{prepend:t(()=>[e(f,{icon:"$new",size:"x-large"})]),default:t(()=>[s[5]||(s[5]=o(" 방문경로 관리 "))]),_:1}),e(x,{onClick:xe,color:"primary",variant:"outlined"},{prepend:t(()=>[e(f,{icon:"$new",size:"x-large"})]),default:t(()=>[s[6]||(s[6]=o(" 운동목적 관리 "))]),_:1})]),default:t(()=>[F(z)?(y(),q("div",Mt,[e(Ie,{color:"secondary",height:"6",indeterminate:"",rounded:""})])):O("",!0),F(z)?O("",!0):(y(),q("div",Lt,[e(Ue,{headers:N,items:F(J),search:l.value,"onClick:row":pe,hover:""},{top:t(()=>[e(Be,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=m=>l.value=m),variant:"solo-filled",class:"pa-2",label:"검색"},null,8,["modelValue"])]),"item.avatar":t(()=>[e(ne,{size:"36px"},{default:t(()=>[e(ue,{alt:"Avatar",src:Dt})]),_:1})]),"item.getUtilization":t(({value:m})=>[o(d(te(m)),1)]),"item.idx":t(({value:m})=>[u("div",{class:"d-flex ga-6 p-r-5 justify-end",onClick:s[1]||(s[1]=qe(()=>{},["stop"]))},[e(f,{color:"secondary",icon:"$edit",size:"x-large",onClick:L=>de(m)},null,8,["onClick"]),e(f,{color:"disabled",icon:"$delete",size:"x-large",onClick:L=>ce(m)},null,8,["onClick"])])]),_:2},1032,["items","search"])]))]),_:1}),e(Qe,{modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=m=>c.value=m),title:"회원 삭제",message:"이 회원을 삭제하시겠습니까? 삭제된 회원 정보는 복구할 수 없습니다.",icon:"mdi-account-remove","confirm-text":"삭제","cancel-text":"취소","confirm-color":"error",onConfirm:me},null,8,["modelValue"]),e(Xe,{notice:n.value,onOnClose:fe},null,8,["notice"]),e(ot,{drawer:h.value,selectedMember:$.value,getGoodsName:te,onClose:ge,onPurchase:ye},null,8,["drawer","selectedMember"]),e(Pt,{dialog:k.value,goodsList:F(A),onClose:le,onPurchase:be},null,8,["dialog","goodsList"]),e(je,{modelValue:E.value,"onUpdate:modelValue":s[3]||(s[3]=m=>E.value=m),title:Ce.value,categories:ke.value,onAdd:we,onEdit:$e,onDelete:Pe},null,8,["modelValue","title","categories"]),e(He,{modelValue:R.value,"onUpdate:modelValue":s[4]||(s[4]=m=>R.value=m),title:he.value,label:Ve.value,"initial-value":((_=M.value)==null?void 0:_.name)||"",onConfirm:Me},null,8,["modelValue","title","label","initial-value"])]}),_:1}))}});export{jt as default};
