import{x as S,G as n,aN as B,aH as F,aI as y,c as D,w as u,o as R,f as a,m as T,h as Y,A as s,aO as j,X as z,a7 as E,a3 as w,a4 as r,L as m,H as f,E as I,s as H,Z as $,J as P,b as C,aP as A}from"./index-ChThWpwh.js";import{U as G,_ as J}from"./UiParentCard.vue_vue_type_script_setup_true_lang-CBB4u1YX.js";import{u as O}from"./members-BzmwLjda.js";import{a as h}from"./axios-D8WuJDhL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={key:0},Z={class:"d-flex ga-6 mt-8 justify-end"},te=S({__name:"MemberForm",setup(K){const N=B(),U=A(),p=n(""),x=n(!1),v=n(!1),M=n(),d=O(),c=n([]),V=n([]),b=n([]);N.params.id?(p.value="Edit Member",d.fetchById(Number(N.params.id))):(p.value="회원 등록",d.initNewMember());const{member:e}=F(d);y(async()=>{try{const o=await h.get("/api/common/getPurposeList");c.value=o.data.data}catch(o){console.error("Failed to fetch purpose list:",o),c.value=[]}}),y(async()=>{try{const o=await h.get("/api/common/getVisitPathList");V.value=o.data.data}catch(o){console.error("Failed to fetch visitpath list:",o),V.value=[]}}),y(async()=>{try{const o=await h.get("/api/member/getStaffList");b.value=o.data.data}catch(o){console.error("Failed to fetch staff list:",o),b.value=[]}});const g=o=>o?!0:"This field is required.",_=[g,o=>(o==null?void 0:o.length)<=20?!0:"Name must be less than 20 characters."],k=[g,o=>/^[0-9-]+$/.test(o)?!0:"Phone must contain only numbers and hyphens."];function q(){U.replace({path:"/members"})}async function L(o){o.preventDefault();const{valid:l}=await M.value.validate();if(l&&e.value){v.value=!0;let t;const i={userName:e.value.userName,gender:e.value.gender,phone:e.value.phone};e.value.birth&&(i.birth=Number(e.value.birth)),e.value.age&&(i.age=Number(e.value.age)),e.value.address&&(i.address=e.value.address),e.value.consultant&&(i.consultant=e.value.consultant),e.value.purpose&&(i.purpose=e.value.purpose),e.value.visitPath&&(i.visitPath=e.value.visitPath),e.value.getUtilization&&(i.getUtilization=e.value.getUtilization),e.value.getRenting&&(i.getRenting=e.value.getRenting),console.log("Sending memberRequest:",i),e.value.idx?t=await d.updateMember(e.value.idx,i):t=await d.createMember(i),t.success&&U.replace({path:"/members"}),v.value=!1}}return(o,l)=>(R(),D(G,null,{default:u(()=>[a(J,{title:p.value},{default:u(()=>[!s(d).loading&&s(e)?(R(),T("div",X,[a(j,{ref_key:"form",ref:M,modelValue:x.value,"onUpdate:modelValue":l[9]||(l[9]=t=>x.value=t),onSubmit:l[10]||(l[10]=z(()=>{},["prevent"]))},{default:u(()=>[a(E,null,{default:u(()=>[a(w,null,{default:u(()=>[a(r,{cols:"12",md:"4"},{default:u(()=>[a(m,{modelValue:s(e).userName,"onUpdate:modelValue":l[0]||(l[0]=t=>s(e).userName=t),rules:_,label:"이름",variant:"solo-filled",required:""},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",md:"4"},{default:u(()=>[a(f,{modelValue:s(e).gender,"onUpdate:modelValue":l[1]||(l[1]=t=>s(e).gender=t),rules:[g],label:"성별",items:["남","여"],variant:"solo-filled",required:""},null,8,["modelValue","rules"])]),_:1}),a(r,{cols:"12",md:"4"},{default:u(()=>[a(m,{modelValue:s(e).birth,"onUpdate:modelValue":l[2]||(l[2]=t=>s(e).birth=t),modelModifiers:{number:!0},type:"number",label:"생년월일 (예: 19900101)",variant:"solo-filled",placeholder:"YYYYMMDD"},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",md:"4"},{default:u(()=>[a(m,{modelValue:s(e).age,"onUpdate:modelValue":l[3]||(l[3]=t=>s(e).age=t),modelModifiers:{number:!0},type:"number",label:"나이",variant:"solo-filled"},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",md:"4"},{default:u(()=>[a(m,{modelValue:s(e).phone,"onUpdate:modelValue":l[4]||(l[4]=t=>s(e).phone=t),rules:k,label:"연락처",variant:"solo-filled",required:"",placeholder:"010-1234-5678"},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",md:"4"},{default:u(()=>[a(f,{modelValue:s(e).consultant,"onUpdate:modelValue":l[5]||(l[5]=t=>s(e).consultant=t),items:b.value,"item-title":"name","item-value":"idx",label:"상담자",variant:"solo-filled",clearable:""},null,8,["modelValue","items"])]),_:1}),a(r,{cols:"12",md:"4"},{default:u(()=>[a(f,{modelValue:s(e).visitPath,"onUpdate:modelValue":l[6]||(l[6]=t=>s(e).visitPath=t),items:V.value,"item-title":"visitPathName","item-value":"idx",label:"방문 경로",variant:"solo-filled",clearable:""},null,8,["modelValue","items"])]),_:1}),a(r,{cols:"12",md:"4"},{default:u(()=>[a(f,{modelValue:s(e).purpose,"onUpdate:modelValue":l[7]||(l[7]=t=>s(e).purpose=t),items:c.value,"item-title":"purposeName","item-value":"idx",label:"운동 목적",variant:"solo-filled",clearable:""},null,8,["modelValue","items"])]),_:1}),a(r,{cols:"12",md:"8"},{default:u(()=>[a(m,{modelValue:s(e).address,"onUpdate:modelValue":l[8]||(l[8]=t=>s(e).address=t),label:"주소",variant:"solo-filled"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(I),a(w,{justify:"end"},{default:u(()=>[a(r,{cols:"12",lg:"2",md:"6",sm:"12",justify:"end",class:""},{default:u(()=>[a($),H("div",Z,[a(P,{loading:v.value,color:"secondary",variant:"flat",type:"submit",onClick:L},{default:u(()=>l[11]||(l[11]=[C(" 등록 ")])),_:1},8,["loading"]),a(P,{onClick:q,color:"primary",variant:"outlined"},{default:u(()=>l[12]||(l[12]=[C(" 취소 ")])),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])])):Y("",!0)]),_:1},8,["title"])]),_:1}))}});export{te as default};
