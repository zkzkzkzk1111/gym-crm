import{x as j,G as d,aH as w,aI as D,aN as E,c as A,w as s,o as S,f as a,m as F,h as H,A as t,aO as I,X as L,a7 as P,a3 as _,a4 as u,H as k,L as i,E as J,s as O,Z as X,J as q,b as G,aP as Z}from"./index-ChThWpwh.js";import{U as z,_ as K}from"./UiParentCard.vue_vue_type_script_setup_true_lang-CBB4u1YX.js";import{_ as Q}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-1MLmho_D.js";import{u as W}from"./goods-Cu4v4TCi.js";import{u as Y}from"./staff-lYDUuXCw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./goodsService-D9gxH4bt.js";import"./axios-D8WuJDhL.js";import"./staffService-B334Pa8R.js";const h={key:0},ee={class:"d-flex ga-6 mt-8 justify-end"},me=j({__name:"EditGoods",setup(le){const c=E(),b=Z(),p=d(""),g=d(!1),v=d(!1),C=d(),r=W(),N=Y(),V=d(!1),y=d(""),{goods:e,allGoodsTypes:R}=w(r),{staffList:B}=w(N);D(async()=>{await Promise.all([r.fetchGoodsType(),N.fetchAll()]),c.params.id?(p.value="상품 수정",await r.fetchById(Number(c.params.id))):(p.value="상품등록",r.initNewGoods())});const n=f=>f?!0:"필수사항입니다.",T=[n];function M(){b.replace({path:"/goods"})}function x(){b.replace({path:"/goods"})}async function $(f){f.preventDefault();const{valid:l}=await C.value.validate();if(l&&e.value){v.value=!0;let o;const m={goodsName:e.value.goodsName,duration:Number(e.value.duration),type:e.value.type,useCount:Number(e.value.useCount),instructor:e.value.instructor||null};e.value.cash&&(m.cash=Number(e.value.cash)),e.value.card&&(m.card=Number(e.value.card)),e.value.description&&(m.description=e.value.description);try{c.params.id?(o=await r.updateGoods(e.value.idx,m),y.value="상품이 성공적으로 수정되었습니다."):(o=await r.createGoods(m),y.value="상품이 성공적으로 등록되었습니다."),o.success?V.value=!0:alert(`작업 실패: ${o.error||"알 수 없는 오류"}`)}catch(U){console.error("상품 저장 실패:",U),alert(`작업 실패: ${U.message||"알 수 없는 오류"}`)}finally{v.value=!1}}}return(f,l)=>(S(),A(z,null,{default:s(()=>[a(K,{title:p.value},{default:s(()=>[!t(r).loading&&t(e)?(S(),F("div",h,[a(I,{ref_key:"form",ref:C,modelValue:g.value,"onUpdate:modelValue":l[8]||(l[8]=o=>g.value=o),onSubmit:l[9]||(l[9]=L(()=>{},["prevent"]))},{default:s(()=>[a(P,null,{default:s(()=>[a(_,null,{default:s(()=>[a(u,{cols:"12",md:"4"},{default:s(()=>[a(k,{modelValue:t(e).type,"onUpdate:modelValue":l[0]||(l[0]=o=>t(e).type=o),rules:[n],label:"종류",items:t(R),"item-title":"typeName","item-value":"idx",variant:"solo-filled",required:""},null,8,["modelValue","rules","items"])]),_:1}),a(u,{cols:"12",md:"4"},{default:s(()=>[a(i,{modelValue:t(e).goodsName,"onUpdate:modelValue":l[1]||(l[1]=o=>t(e).goodsName=o),rules:T,label:"상품명",variant:"solo-filled",required:""},null,8,["modelValue"])]),_:1}),a(u,{cols:"12",md:"4"},{default:s(()=>[a(i,{type:"number",modelValue:t(e).cash,"onUpdate:modelValue":l[2]||(l[2]=o=>t(e).cash=o),rules:[n],variant:"solo-filled",label:"현금가",required:""},null,8,["modelValue","rules"])]),_:1}),a(u,{cols:"12",md:"4"},{default:s(()=>[a(i,{type:"number",modelValue:t(e).card,"onUpdate:modelValue":l[3]||(l[3]=o=>t(e).card=o),rules:[n],variant:"solo-filled",label:"카드가",required:""},null,8,["modelValue","rules"])]),_:1}),a(u,{cols:"12",md:"4"},{default:s(()=>[a(i,{type:"number",modelValue:t(e).duration,"onUpdate:modelValue":l[4]||(l[4]=o=>t(e).duration=o),rules:[n],label:"이용기간(일)",variant:"solo-filled",required:""},null,8,["modelValue","rules"])]),_:1}),a(u,{cols:"12",md:"4"},{default:s(()=>[a(i,{type:"number",modelValue:t(e).useCount,"onUpdate:modelValue":l[5]||(l[5]=o=>t(e).useCount=o),label:"이용횟수",variant:"solo-filled",required:""},null,8,["modelValue"])]),_:1}),a(u,{cols:"12",md:"8"},{default:s(()=>[a(i,{modelValue:t(e).description,"onUpdate:modelValue":l[6]||(l[6]=o=>t(e).description=o),label:"상세설명",variant:"solo-filled"},null,8,["modelValue"])]),_:1}),a(u,{cols:"12",md:"4"},{default:s(()=>[a(k,{modelValue:t(e).instructor,"onUpdate:modelValue":l[7]||(l[7]=o=>t(e).instructor=o),items:t(B),"item-title":"name","item-value":"idx",label:"담당강사",variant:"solo-filled",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),a(J),a(_,{justify:"end"},{default:s(()=>[a(u,{cols:"12",lg:"2",md:"6",sm:"12",justify:"end",class:""},{default:s(()=>[a(X),O("div",ee,[a(q,{loading:v.value,color:"secondary",variant:"flat",type:"submit",onClick:$},{default:s(()=>l[11]||(l[11]=[G(" 등록 ")])),_:1},8,["loading"]),a(q,{onClick:M,color:"primary",variant:"outlined"},{default:s(()=>l[12]||(l[12]=[G(" 취소 ")])),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])])):H("",!0)]),_:1},8,["title"]),a(Q,{modelValue:V.value,"onUpdate:modelValue":l[10]||(l[10]=o=>V.value=o),title:"완료",message:y.value,icon:"mdi-check-circle","confirm-text":"확인","cancel-text":"닫기","confirm-color":"primary",onConfirm:x,onCancel:x},null,8,["modelValue","message"])]),_:1}))}});export{me as default};
