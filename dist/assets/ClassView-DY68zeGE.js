import{u as Q}from"./class-DG6Di__7.js";import{u as W,_ as X,a as Y}from"./CategoryInputDialog.vue_vue_type_script_setup_true_lang-wfhkHHWF.js";import{U as Z,_ as ee}from"./UiParentCard.vue_vue_type_script_setup_true_lang-CBB4u1YX.js";import{x as ae,aH as A,G as r,aI as te,ah as le,c as D,w as s,o as d,f as a,m as g,h as $,A as m,aJ as se,L as oe,aM as ne,E as re,a3 as S,F as ie,n as ue,a4 as I,g as L,b as h,t as o,J as T,_ as de,ab as ce,aw as fe,ac as me,s as c,aG as ve,aL as B}from"./index-ChThWpwh.js";import{_ as pe}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-1MLmho_D.js";import{_ as Ce}from"./NotificeBar-SNjTBcAG.js";import"./classService-DyrUrkM7.js";import"./axios-D8WuJDhL.js";import"./staffService-B334Pa8R.js";import"./goodsService-D9gxH4bt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const _e={key:0},ye={key:1},ge={class:"text-h6 mb-2"},he={class:"text-h6 mb-2"},Ve={class:"text-h6 mb-2"},xe={class:"text-h6 mb-2"},$e={key:0,class:"text-body-2 mt-3"},Ue=ae({__name:"ClassView",setup(Te){const v=Q(),i=W(),{filteredClass:w,filter:V,loading:b}=A(v),{classTypes:E}=A(i),p=r(!1),n=r(!1),C=r(null),x=r(!1),_=r(!1),u=r("add"),f=r(null);te(()=>{v.fetchAll(),i.fetchAll()});function U(t){B.replace({path:`/editClass/${t}`})}function F(t){p.value=!0,C.value=t}function M(){C.value!==null&&v.deleteClass(C.value).then(t=>{p.value=!1,t.success&&(n.value=!0,setTimeout(()=>{n.value=!1,v.fetchAll()},1e3))}).finally(()=>C.value=null)}function j(){p.value=!1}function z(){n.value=!1}function O(){B.replace({path:"/class/new"})}async function R(){await i.fetchClassTypes(),x.value=!0}const G=le(()=>E.value.map(t=>({id:t.idx,name:t.typeName})));function J(){u.value="add",f.value=null,_.value=!0}function H(t){u.value="edit",f.value=t,_.value=!0}async function P(t){if(confirm(`${t.name}을(를) 삭제하시겠습니까?`))try{const e=await i.deleteClassType(t.id);e.success?(n.value=!0,setTimeout(()=>{n.value=!1},1e3)):alert(`삭제에 실패했습니다: ${e.error||"알 수 없는 오류"}`)}catch(e){console.error("카테고리 삭제 실패:",e),alert(`삭제에 실패했습니다: ${e.message||"알 수 없는 오류"}`)}}async function q(t){try{let e;if(u.value==="add")e=await i.createClassType(t);else{if(!f.value)return;e=await i.updateClassType(f.value.id,t)}e.success?(n.value=!0,setTimeout(()=>{n.value=!1},1e3)):alert(`${u.value==="add"?"추가":"수정"}에 실패했습니다: ${e.error||"알 수 없는 오류"}`)}catch(e){console.error("카테고리 처리 실패:",e),alert(`${u.value==="add"?"추가":"수정"}에 실패했습니다: ${e.message||"알 수 없는 오류"}`)}}return(t,e)=>(d(),D(Z,null,{default:s(()=>{var k;return[a(ee,{title:"수업 관리",createFn:O},{"extra-actions":s(()=>[a(T,{onClick:R,color:"primary",variant:"outlined"},{prepend:s(()=>[a(de,{icon:"$new",size:"x-large"})]),default:s(()=>[e[3]||(e[3]=h(" 수업 타입 관리 "))]),_:1})]),default:s(()=>[m(b)?(d(),g("div",_e,[a(se,{color:"secondary",height:"6",indeterminate:"",rounded:""})])):$("",!0),m(b)?$("",!0):(d(),g("div",ye,[a(oe,{modelValue:m(V),"onUpdate:modelValue":e[0]||(e[0]=l=>ne(V)?V.value=l:null),variant:"solo-filled",class:"pa-2",label:"검색"},null,8,["modelValue"]),a(re,{class:"mb-10"}),a(S,null,{default:s(()=>[(d(!0),g(ie,null,ue(m(w),(l,K)=>(d(),D(I,{cols:"12",md:"4",sm:"6",key:K},{default:s(()=>[a(ce,{variant:"elevated",class:"mx-auto ma-5","max-width":"360"},{default:s(()=>[a(fe,{class:"text-h3"},{default:s(()=>[h(o(l.className)+" ("+o(l.instructorName)+") ",1)]),_:2},1024),a(me,null,{default:s(()=>{var y,N;return[c("div",ge,"이용기간: "+o(l.duration)+"개월",1),c("div",he,"이용가능 횟수: "+o(l.useCount)+"회",1),c("div",Ve,"현금가: "+o((y=l.cash)==null?void 0:y.toLocaleString())+"원",1),c("div",xe,"카드가: "+o((N=l.card)==null?void 0:N.toLocaleString())+"원",1),l.description?(d(),g("div",$e,o(l.description),1)):$("",!0)]}),_:2},1024),a(ve,{class:"d-flex justify-space-between"},{default:s(()=>[c("div",null,[a(L,{color:"primary"},{default:s(()=>[h("타입: "+o(l.typeName),1)]),_:2},1024)]),c("div",null,[a(T,{color:"secondary mb-0",variant:"outlined",text:"수정",title:"Edit",size:"small",onClick:y=>U(l.idx)},null,8,["onClick"]),a(T,{color:"error",variant:"plain",text:"삭제",size:"small",onClick:y=>F(l.idx)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),a(S,{justify:"center"},{default:s(()=>[a(I,{cols:"12",lg:"12",class:"d-flex justify-center"},{default:s(()=>[a(L,{class:"text-h5",color:"primary"},{default:s(()=>[h(" 총 수업 수: "+o(m(w).length),1)]),_:1})]),_:1})]),_:1})]))]),_:1}),a(pe,{dialog:p.value,onOnConfirm:M,onOnCancel:j},null,8,["dialog"]),a(Ce,{notice:n.value,onOnClose:z},null,8,["notice"]),a(X,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=l=>x.value=l),title:"수업 타입 관리",categories:G.value,onAdd:J,onEdit:H,onDelete:P},null,8,["modelValue","categories"]),a(Y,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),title:u.value==="add"?"수업 타입 추가":"수업 타입 수정",label:"타입 이름","initial-value":((k=f.value)==null?void 0:k.name)||"",onConfirm:q},null,8,["modelValue","title","initial-value"])]}),_:1}))}});export{Ue as default};
