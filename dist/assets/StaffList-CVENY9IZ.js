import{u as R}from"./staff-lYDUuXCw.js";import{u as F,_ as H,a as J}from"./CategoryInputDialog.vue_vue_type_script_setup_true_lang-wfhkHHWF.js";import{U as P,_ as j}from"./UiParentCard.vue_vue_type_script_setup_true_lang-CBB4u1YX.js";import{x as K,aH as h,G as r,aI as q,ah as Q,c as W,w as l,o as g,f as t,m as $,h as k,A as y,aJ as X,aK as Y,s as Z,_ as C,u as ee,aC as ae,L as te,J as le,b as oe,aL as x}from"./index-ChThWpwh.js";import{_ as ne}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-1MLmho_D.js";import{_ as re}from"./NotificeBar-SNjTBcAG.js";import"./staffService-B334Pa8R.js";import"./axios-D8WuJDhL.js";import"./goodsService-D9gxH4bt.js";import"./classService-DyrUrkM7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se={key:0},ie={key:1},ue={class:"d-flex ga-6 p-r-5 justify-end"},de="/src/assets/images/customer/avatar-0.webp",ke=K({__name:"StaffList",setup(ce){const S=[{title:"",key:"avatar",align:"start"},{title:"등급",key:"gradeName",align:"start"},{title:"이름",key:"name",align:"start"},{title:"연락처",key:"phone",align:"start"},{title:"성별",key:"gender",align:"start"},{title:"",key:"idx",align:"end"}],d=R(),s=F(),{filteredStaff:A,loading:_}=h(d),{staffGrades:w}=h(s),c=r(!1),v=r(""),o=r(!1),f=r(null),p=r(!1),m=r(!1),i=r("add"),u=r(null);q(()=>{d.fetchAll(),s.fetchAll()});function T(a){x.replace({path:`/staff/${a}`})}function D(a){c.value=!0,f.value=a}function G(){f.value!==null&&d.deleteStaff(f.value).then(a=>{c.value=!1,a.success&&(o.value=!0,setTimeout(()=>{o.value=!1,d.fetchAll()},1e3))}).finally(()=>f.value=null)}function I(){c.value=!1}function b(){o.value=!1}function L(){x.replace({path:"/staff/write"})}async function B(){await s.fetchStaffGrades(),p.value=!0}const E=Q(()=>w.value.map(a=>({id:a.idx,name:a.name})));function N(){i.value="add",u.value=null,m.value=!0}function U(a){i.value="edit",u.value=a,m.value=!0}async function z(a){if(confirm(`${a.name}을(를) 삭제하시겠습니까?`))try{const e=await s.deleteStaffGrade(a.id);e.success?(o.value=!0,setTimeout(()=>{o.value=!1},1e3)):alert(`삭제에 실패했습니다: ${e.error||"알 수 없는 오류"}`)}catch(e){console.error("카테고리 삭제 실패:",e),alert(`삭제에 실패했습니다: ${e.message||"알 수 없는 오류"}`)}}async function O(a){try{let e;if(i.value==="add")e=await s.createStaffGrade(a);else{if(!u.value)return;e=await s.updateStaffGrade(u.value.id,a)}e.success?(o.value=!0,setTimeout(()=>{o.value=!1},1e3)):alert(`${i.value==="add"?"추가":"수정"}에 실패했습니다: ${e.error||"알 수 없는 오류"}`)}catch(e){console.error("카테고리 처리 실패:",e),alert(`${i.value==="add"?"추가":"수정"}에 실패했습니다: ${e.message||"알 수 없는 오류"}`)}}return(a,e)=>(g(),W(P,null,{default:l(()=>{var V;return[t(j,{title:"직원 관리",createFn:L},{"extra-actions":l(()=>[t(le,{onClick:B,color:"primary",variant:"outlined"},{prepend:l(()=>[t(C,{icon:"$new",size:"x-large"})]),default:l(()=>[e[3]||(e[3]=oe(" 직원 등급 관리 "))]),_:1})]),default:l(()=>[y(_)?(g(),$("div",se,[t(X,{color:"secondary",height:"6",indeterminate:"",rounded:""})])):k("",!0),y(_)?k("",!0):(g(),$("div",ie,[t(Y,{headers:S,items:y(A),search:v.value},{top:l(()=>[t(te,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=n=>v.value=n),variant:"solo-filled",class:"pa-2",label:"검색"},null,8,["modelValue"])]),"item.avatar":l(()=>[t(ee,{size:"36px"},{default:l(()=>[t(ae,{alt:"Avatar",src:de})]),_:1})]),"item.idx":l(({value:n})=>[Z("div",ue,[t(C,{color:"secondary",icon:"$edit",size:"x-large",onClick:M=>T(n)},null,8,["onClick"]),t(C,{color:"disabled",icon:"$delete",size:"x-large",onClick:M=>D(n)},null,8,["onClick"])])]),_:2},1032,["items","search"])]))]),_:1}),t(ne,{dialog:c.value,onOnConfirm:G,onOnCancel:I},null,8,["dialog"]),t(re,{notice:o.value,onOnClose:b},null,8,["notice"]),t(H,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=n=>p.value=n),title:"직원 등급 관리",categories:E.value,onAdd:N,onEdit:U,onDelete:z},null,8,["modelValue","categories"]),t(J,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=n=>m.value=n),title:i.value==="add"?"직원 등급 추가":"직원 등급 수정",label:"등급 이름","initial-value":((V=u.value)==null?void 0:V.name)||"",onConfirm:O},null,8,["modelValue","title","initial-value"])]}),_:1}))}});export{ke as default};
