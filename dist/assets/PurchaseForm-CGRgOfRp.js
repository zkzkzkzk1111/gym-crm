import{x as A,G as d,aN as B,aH as D,aI as S,c as N,w as u,o as h,f as e,m as P,h as I,A as Y,aO as $,X as j,a7 as E,a3 as q,a4 as r,L as n,H as g,E as F,s as T,Z as H,J as x,b as C,t as G,aP as J}from"./index-ChThWpwh.js";import{U as L,_ as O}from"./UiParentCard.vue_vue_type_script_setup_true_lang-CBB4u1YX.js";import{u as X}from"./purchase-Dvd9RgU3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./axios-D8WuJDhL.js";const Z={key:0},z={class:"d-flex ga-6 mt-8 justify-end"},te=A({__name:"PurchaseForm",setup(K){const c=B(),y=J(),b=d("구매 내역 등록"),M=d(!1),v=d(!1),U=d(),m=X(),t=d({type:"",name:"",buyer:"",cnt:0,price:0,paymentMethod:"",paidAt:"",status:0,phone:""}),p=d(!1),f=d(null);c.params.idx&&(b.value="구매 내역 수정",p.value=!0,f.value=parseInt(c.params.idx),m.fetchById(f.value));const{purchase:s}=D(m);S(()=>{p.value&&s.value&&(t.value={type:s.value.type,name:s.value.name,buyer:s.value.buyer,cnt:s.value.cnt,price:s.value.price,paymentMethod:s.value.paymentMethod,paidAt:s.value.paidAt,status:s.value.status,phone:s.value.phone})});const i=o=>o?!0:"필수 입력 항목입니다.",V=[i,o=>(o==null?void 0:o.length)<=50?!0:"이름은 50자 이하여야 합니다."],R=[i,o=>/^[0-9-]+$/.test(o)?!0:"올바른 전화번호 형식이 아닙니다."],_=[i,o=>o>0?!0:"0보다 큰 값을 입력해주세요."];function w(){y.replace({path:"/purchase"})}async function k(o){o.preventDefault();const{valid:a}=await U.value.validate();if(a){v.value=!0;try{let l;p.value&&f.value?l=await m.updatePurchase(f.value,t.value):l=await m.createPurchase(t.value),l.success?y.replace({path:"/purchase"}):alert(`저장에 실패했습니다: ${l.error||"알 수 없는 오류"}`)}catch(l){console.error("구매 내역 저장 실패:",l),alert(`저장에 실패했습니다: ${l.message||"알 수 없는 오류"}`)}finally{v.value=!1}}}return(o,a)=>(h(),N(L,null,{default:u(()=>[e(O,{title:b.value},{default:u(()=>[Y(m).loading?I("",!0):(h(),P("div",Z,[e($,{ref_key:"form",ref:U,modelValue:M.value,"onUpdate:modelValue":a[9]||(a[9]=l=>M.value=l),onSubmit:j(k,["prevent"])},{default:u(()=>[e(E,null,{default:u(()=>[e(q,null,{default:u(()=>[e(r,{cols:"12",md:"6"},{default:u(()=>[e(n,{modelValue:t.value.type,"onUpdate:modelValue":a[0]||(a[0]=l=>t.value.type=l),rules:V,label:"타입",variant:"solo-filled",required:""},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",md:"6"},{default:u(()=>[e(n,{modelValue:t.value.name,"onUpdate:modelValue":a[1]||(a[1]=l=>t.value.name=l),rules:V,label:"상품명",variant:"solo-filled",required:""},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",md:"6"},{default:u(()=>[e(n,{modelValue:t.value.buyer,"onUpdate:modelValue":a[2]||(a[2]=l=>t.value.buyer=l),rules:V,label:"구매자",variant:"solo-filled",required:""},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",md:"6"},{default:u(()=>[e(n,{modelValue:t.value.phone,"onUpdate:modelValue":a[3]||(a[3]=l=>t.value.phone=l),rules:R,label:"연락처",variant:"solo-filled",required:""},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",md:"6"},{default:u(()=>[e(n,{modelValue:t.value.cnt,"onUpdate:modelValue":a[4]||(a[4]=l=>t.value.cnt=l),modelModifiers:{number:!0},rules:_,label:"갯수",type:"number",variant:"solo-filled",required:""},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",md:"6"},{default:u(()=>[e(n,{modelValue:t.value.price,"onUpdate:modelValue":a[5]||(a[5]=l=>t.value.price=l),modelModifiers:{number:!0},rules:_,label:"가격",type:"number",variant:"solo-filled",required:""},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",md:"6"},{default:u(()=>[e(g,{modelValue:t.value.paymentMethod,"onUpdate:modelValue":a[6]||(a[6]=l=>t.value.paymentMethod=l),items:["현금","카드","계좌이체"],rules:[i],label:"결제수단",variant:"solo-filled",required:""},null,8,["modelValue","rules"])]),_:1}),e(r,{cols:"12",md:"6"},{default:u(()=>[e(n,{modelValue:t.value.paidAt,"onUpdate:modelValue":a[7]||(a[7]=l=>t.value.paidAt=l),rules:[i],label:"결제일 (YYYY-MM-DD)",variant:"solo-filled",placeholder:"2024-01-01",required:""},null,8,["modelValue","rules"])]),_:1}),e(r,{cols:"12",md:"6"},{default:u(()=>[e(g,{modelValue:t.value.status,"onUpdate:modelValue":a[8]||(a[8]=l=>t.value.status=l),modelModifiers:{number:!0},items:[{title:"대기",value:0},{title:"완료",value:1},{title:"취소",value:-1}],rules:[i],label:"상태",variant:"solo-filled",required:""},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(F,{class:"my-5"}),e(q,{justify:"end"},{default:u(()=>[e(r,{cols:"12",lg:"2",md:"6",sm:"12",justify:"end"},{default:u(()=>[e(H),T("div",z,[e(x,{loading:v.value,color:"secondary",variant:"flat",type:"submit"},{default:u(()=>[C(G(p.value?"수정":"등록"),1)]),_:1},8,["loading"]),e(x,{onClick:w,color:"primary",variant:"outlined"},{default:u(()=>a[10]||(a[10]=[C(" 취소 ")])),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))]),_:1},8,["title"])]),_:1}))}});export{te as default};
